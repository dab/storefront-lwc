<template>
  <div class="slds-card slds-m-around_medium">
    <div class="slds-card__header slds-grid">
      <header class="slds-media slds-media_center slds-has-flexi-truncate">
        <div class="slds-media__body">
          <h2 class="slds-card__header-title">
            <button
              class="slds-button slds-button_reset slds-text-heading_small"
              onclick="{handleToggleCart}"
              aria-expanded="{isExpanded}"
            >
              <svg class="slds-button__icon slds-button__icon_left" aria-hidden="true">
                <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#cart"></use>
              </svg>
              {cartSummaryText}
            </button>
          </h2>
        </div>
        <div class="slds-no-flex">
          <span class="slds-text-heading_medium slds-text-color_success"> {formattedTotal} </span>
        </div>
      </header>
    </div>

    <template if:true="{isExpanded}">
      <div class="slds-card__body slds-card__body_inner">
        <template if:true="{isEmpty}">
          <div class="slds-text-align_center slds-p-vertical_large">
            <svg class="slds-icon slds-icon_large slds-icon-text-default" aria-hidden="true">
              <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#cart"></use>
            </svg>
            <h3 class="slds-text-heading_small slds-m-top_small">Your cart is empty</h3>
            <p class="slds-text-body_regular slds-text-color_weak">
              Add some bikes to get started!
            </p>
          </div>
        </template>

        <template if:false="{isEmpty}">
          <div class="slds-feed">
            <template for:each="{cartItemsWithFormatting}" for:item="item">
              <article key="{item.cartId}" class="slds-feed__item">
                <div class="slds-media">
                  <div class="slds-media__figure">
                    <img src="{item.image}" alt="{item.name}" class="cart-item-image" />
                  </div>
                  <div class="slds-media__body">
                    <div class="slds-grid slds-grid_align-spread">
                      <div class="slds-col">
                        <h4 class="slds-text-body_regular slds-text-color_default">{item.name}</h4>
                        <p class="slds-text-body_small slds-text-color_weak">
                          Color: {item.selectedColor}
                        </p>
                        <p class="slds-text-body_small">{item.formattedPrice} each</p>
                      </div>
                      <div class="slds-col slds-no-flex">
                        <div class="slds-form-element slds-form-element_small">
                          <label class="slds-form-element__label" for="{item.quantityId}"
                            >Qty</label
                          >
                          <div class="slds-form-element__control">
                            <input
                              id="{item.quantityId}"
                              type="number"
                              min="1"
                              max="10"
                              value="{item.quantity}"
                              data-cart-id="{item.cartId}"
                              onchange="{handleQuantityChange}"
                              class="slds-input quantity-input"
                            />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="slds-grid slds-grid_align-spread slds-m-top_x-small">
                      <div class="slds-col">
                        <span class="slds-text-body_small slds-text-color_success">
                          Line total: {item.formattedLineTotal}
                        </span>
                      </div>
                      <div class="slds-col slds-no-flex">
                        <button
                          class="slds-button slds-button_text-destructive"
                          data-cart-id="{item.cartId}"
                          onclick="{handleRemoveItem}"
                        >
                          Remove
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </article>
            </template>
          </div>
        </template>
      </div>

      <template if:false="{isEmpty}">
        <footer class="slds-card__footer">
          <div class="slds-grid slds-grid_align-spread">
            <div class="slds-col">
              <span class="slds-text-heading_small">Total: {formattedTotal}</span>
            </div>
            <div class="slds-col slds-no-flex">
              <button class="slds-button slds-button_brand" disabled>Checkout (Coming Soon)</button>
            </div>
          </div>
        </footer>
      </template>
    </template>
  </div>
</template>
